# 数据分析工具集

这是一个基于Python和PyQt6开发的数据分析工具集合，包含多个实用的数据处理模块，主要用于数据分析和格式转换。

## 功能模块

### 1. 统一入口界面
项目提供了一个统一的登录窗口，可以通过该界面访问所有功能模块：
- 三保支出进度工具
- 会计核算偏离度工具
- JSON转Excel工具

界面特点：
- 简洁直观的操作界面
- 统一的主题风格和交互体验
- 支持深色/浅色主题切换
- 所有模块一键访问

### 2. 三保支出进度工具 (sanbao_test)

该工具用于分析和计算"三保"支出进度，主要功能包括：
- 加载预算执行数据文件
- 筛选特定预算单位和三保标识类型
- 计算各类支出金额及进度百分比
- 导出分析结果到Excel文件
- 实时日志显示操作过程

#### 主要特性：
- 支持Excel数据文件导入（.xlsx格式）
- 可自定义筛选条件（预算单位、三保标识类型）
- 提供详细的操作日志
- 结果可导出为Excel格式
- 多线程处理避免界面冻结
- 支持深色/浅色主题切换
- 实时进度反馈

#### 使用流程：
1. 点击"选择Excel文件"按钮加载预算执行数据
2. 在预算单位列表中选择需要分析的单位（支持多选）
3. 在三保标识类型中选择需要分析的类型（支持多选）
4. 点击"开始分析"按钮进行数据分析
5. 查看分析结果并可选择导出到Excel文件

### 3. 会计核算偏离度工具 (kjhs_test)

此工具用于比较会计核算数据与预算执行数据，计算两者之间的偏离度：
- 读取预算执行数据和会计核算数据
- 处理并合并两组数据
- 计算差额和偏离度
- 识别高偏离度项目并标记
- 格式化输出结果到Excel文件

#### 主要特性：
- 支持.xls和.xlsx格式文件
- 自动跳过文件头部无关信息
- 高偏离度自动识别和标记
- 专业格式化的Excel输出
- 多线程处理避免界面冻结
- 支持深色/浅色主题切换
- 进度条实时显示处理状态

#### 使用流程：
1. 选择预算执行数据文件
2. 选择会计核算数据文件
3. 设置高偏离度阈值（默认为10%）
4. 点击"开始处理"按钮进行数据比对分析
5. 查看处理结果，可导出Excel文件进行后续分析

### 4. JSON转Excel工具 (json_to_excel)

该工具可以将JSON格式的数据文件转换为Excel表格：
- 支持复杂嵌套结构的JSON数据
- 自动展平嵌套字段
- 处理数组类型数据
- 转换结果保存为.xlsx文件

#### 主要特性：
- 多线程后台转换，避免界面卡顿
- 进度条显示转换进度
- 支持各种JSON数据结构
- 自动生成规范的Excel文件
- 支持深色/浅色主题切换
- 支持大型JSON文件处理

#### 使用流程：
1. 点击"选择JSON文件"按钮选择待转换的JSON文件
2. 点击"选择输出路径"指定转换后Excel文件的保存位置
3. 点击"开始转换"按钮进行转换
4. 等待转换完成，可在日志区域查看转换过程

## 技术架构

本项目采用模块化设计，以`main.py`为程序入口，通过统一界面访问各个功能模块。各功能模块相对独立，便于维护和扩展。

主要设计原则：
- 模块化设计：每个功能模块独立存放于单独目录
- 单一职责原则：GUI逻辑与业务逻辑分离
- 多线程模式：耗时操作使用线程执行，防止UI冻结
- 统一主题：所有界面共享统一的视觉风格

## 技术栈

- Python 3.14+
- PyQt6: 图形界面框架
- Pandas: 数据处理和分析
- OpenPyXL: Excel文件处理
- xlrd: 旧版Excel(.xls)文件读取
- PyInstaller: 可执行文件打包
- polars: 数据处理库
- PyYAML: YAML文件处理

## 项目结构

```
数据分析工具集/
├── common/                 # 公共组件
│   ├── __init__.py
│   ├── animated.py         # 动画按钮组件
│   ├── logger.py           # 日志记录器
│   ├── styles.py           # 样式和主题管理
│   └── window_utils.py     # 窗口工具函数
├── json_to_excel/          # JSON转Excel模块
│   ├── json_to_excel_pyqt.py
│   ├── role.json
│   └── set_code.json
├── kjhs_test/              # 会计核算偏离度模块
│   └── pld_pyqt6.py
├── sanbao_test/            # 三保支出进度模块
│   ├── app_copy.py
│   ├── constants_copy.py
│   └── gui_utils.py
├── main.py                 # 程序入口和主界面
├── pyproject.toml          # 项目配置文件
└── README.md               # 项目说明文档
```

## 安装依赖

项目使用uv作为包管理工具，可通过以下命令安装依赖：

```bash
uv pip install -r requirements.txt
```

或根据pyproject.toml安装：

```bash
uv pip install .
```

## 使用方法

运行主程序启动统一界面：

```bash
python main.py
```

然后在界面上选择需要使用的功能模块。

### 各模块详细使用说明

#### 三保支出进度工具
1. 点击主界面的"三保支出进度工具"按钮进入功能界面
2. 点击"选择Excel文件"按钮加载预算执行数据文件
3. 在预算单位区域勾选需要分析的预算单位（可多选）
4. 在三保标识类型区域勾选需要分析的类型（可多选）
5. 点击"开始分析"按钮进行数据分析
6. 分析完成后可在结果区域查看数据，也可点击"导出结果"保存为Excel文件

#### 会计核算偏离度工具
1. 点击主界面的"会计核算偏离度工具"按钮进入功能界面
2. 点击"选择预算执行文件"按钮选择预算执行数据文件
3. 点击"选择会计核算文件"按钮选择会计核算数据文件
4. 如需修改高偏离度阈值，可在相应输入框中修改（默认10%）
5. 点击"开始处理"按钮进行数据比对分析
6. 处理完成后可点击"导出结果"保存为Excel文件

#### JSON转Excel工具
1. 点击主界面的"JSON转Excel工具"按钮进入功能界面
2. 点击"选择JSON文件"按钮选择待转换的JSON文件
3. 点击"选择输出路径"按钮指定转换后Excel文件的保存位置和文件名
4. 点击"开始转换"按钮进行转换
5. 转换完成后可在日志区域看到"转换成功"提示

## 打包可执行文件

使用PyInstaller打包为独立可执行文件：

```bash
pyinstaller --onefile main.py
```

打包后的可执行文件位于dist目录下，可在没有Python环境的Windows系统上直接运行。

## 开发指南

### 项目开发环境搭建
1. 安装Python 3.14+
2. 安装uv包管理器
3. 克隆项目代码
4. 运行以下命令安装依赖：
   ```bash
   uv pip install -r requirements.txt
   ```
   或
   ```bash
   uv pip install .
   ```

### 代码结构说明
- `main.py`: 程序入口文件，负责启动主界面和统一管理各功能模块
- `common/`: 存放公共组件，包括日志记录、样式管理和窗口工具等
- `sanbao_test/`: 三保支出进度分析模块，包含数据处理和界面逻辑
- `kjhs_test/`: 会计核算偏离度分析模块，负责数据比对和分析
- `json_to_excel/`: JSON转Excel模块，处理JSON数据到Excel的转换

### 添加新功能模块
1. 在项目根目录下创建新的功能模块目录
2. 实现功能逻辑和界面代码
3. 在`main.py`中导入新模块并添加到主界面
4. 更新README文档说明

## 注意事项

1. 使用会计核算偏离度工具时，确保系统已安装xlrd库以支持.xls文件读取
2. 所有模块均采用多线程处理耗时操作，防止界面卡顿
3. 界面支持深色和浅色两种主题，可通过"工具"菜单切换
4. 所有操作均有详细日志记录，方便问题排查
5. Excel输入文件格式必须严格符合预设结构，否则可能导致解析失败
6. 大型文件处理可能需要较长时间，请耐心等待
7. 输出文件默认保存在当前运行目录，可根据需要更改保存路径