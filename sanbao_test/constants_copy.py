"""常量配置文件"""

# 布局配置
WINDOW_TITLE = "计算三保支出进度工具" #工具窗口标题
WINDOW_SIZE = "800x600"
PADDING = 10  # 通用内边距
BUTTON_WIDTH = 15  # 按钮宽度


# 指标类型列筛选条件
TARGET_TYPES = [
    '[21]当年预算',
    '[22]上年结转（非权责制）',
    '[23]上年结余（非权责制）'
]

# 国库集中支付实际支出列
GKJZ_ACTUAL_COLS = [
    '集中支付_实际支出数(非政采)',
    '集中支付_实际支出数（政采）',
    '集中支付_转列支出(非政采)',
    '集中支付_转列支出（政采）'
]

# 实拨实际支出列
SHIBO_ACTUAL_COLS = [
    '实拨_实际支出'
]




# 国库集中支付计划数列
GKJZ_PLAN_COLS = [
    '集中支付_计划数(非政采)',
    '集中支付_计划数（政采）',
]

# 实拨计划数列
SHIBO_PLAN_COLS = [
    '实拨_计划数'
]


# 国库集中计划剩余数
GKJZ_REMAINING_COLS = [
    '集中支付_计划剩余数(非政采)',
    '集中支付_计划剩余数（政采）'  #实拨_计划数-实拨_实际支出
]


# 实拨计划剩余数
SHIBO_REMAINING_COLS = [
    '实拨_计划数-实拨_实际支出'
]



# 国库集中申请金额列
GKJZ_APPLY_COLS = [
    '集中支付_申请支出数(非政采)',
    '集中支付_申请支出数（政采）',
]


# 实拨实际支出金额列
SHIBO_APPLY_COLS = [
    '实拨_实际支出'
]


# 结果列
RESULT_COLS = [
    '预算单位',
    '三保标识',
    '调整预算数',
    '计划金额',
    '计划剩余金额',
    '支付申请金额',
    '在途金额',
    '未回单金额',
    '实际支出金额',
    '实际支出进度%',
    '在途+实际支出金额',
    '在途+实际支出进度%',
    '备注'
]

# 错误消息
ERROR_MESSAGES = {
    'NO_FILE': "导出数据文件不存在: {}",
    'NO_DATA': "没有数据可保存",
    'EMPTY_FILTER': "筛选后数据为空，请检查'三保标识'和'指标类型'列的值是否正确",
    'NO_SELECTION': "请至少选择一个三保标识",
}


# 判断预算单位列不等于0
def nonzero_unit_mask(series):
    """给定一个 Series（预算单位列），返回一个布尔掩码，标识哪些行的预算单位不是 0。

    该函数同时处理数值型的 0 和字符串形式的 '0' / '0.0'（会去除前后空白后比较）。
    返回值为与输入长度相同的布尔型 Series，可直接用于 DataFrame 过滤。
    """
    try:
        # 先检查数值型的 0
        mask = ~(
            series.eq(0) |
            series.fillna('').astype(str).str.strip().isin(['0', '0.0'])
        )
    except Exception:
        # 在极端情况下回退为字符串比较
        mask = ~series.fillna('').astype(str).str.strip().isin(['0', '0.0'])
    return mask